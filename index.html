<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Digitální Tržiště</title>

  <!-- GitHub Pages – důležité -->
  <base href="/monster-bigboard-data/">

  <style>
    :root {
      --bg:#0f0f0f; --text:#eee; --muted:#bdbdbd;
      --card:#1b1b1b; --card2:#262626; --line:#2a2a2a;
      --accent:#ffcc00; --sidebar:#141414; --sideW: 300px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Arial,Helvetica,sans-serif}

    .wrap{display:grid;grid-template-columns:var(--sideW) 1fr;grid-template-rows:64px 1fr;grid-template-areas:"head head" "side main";height:100%}
    header{grid-area:head;display:flex;align-items:center;gap:12px;justify-content:center;background:#101010;border-bottom:1px solid #1f1f1f;position:sticky;top:0;z-index:5}
    h1{margin:0;color:var(--accent);letter-spacing:.2px}

    .topright{position:absolute;right:12px;top:10px;display:flex;gap:8px;align-items:center}
    .btn{background:var(--card);border:1px solid var(--line);color:var(--text);padding:8px 10px;border-radius:8px;cursor:pointer}
    .btn:hover{background:var(--card2)}
    .search{background:#111;border:1px solid var(--line);color:#ddd;border-radius:8px;padding:8px 10px;min-width:260px;outline:none}

    aside{grid-area:side;background:var(--sidebar);border-right:1px solid #1f1f1f;padding:12px;overflow:auto;position:sticky;top:64px;height:calc(100vh - 64px)}
    .cat{display:block;padding:10px 12px;margin-bottom:8px;border-radius:10px;background:#171717;border:1px solid #242424;text-decoration:none;color:var(--text);cursor:pointer}
    .cat.active{outline:2px solid var(--accent)}
    .small{display:block;color:var(--muted);margin-top:2px;font-size:.9em}

    main{grid-area:main;overflow:auto;padding:16px;transform-origin:0 0}
    .grid{display:grid;grid-template-columns:repeat(12,minmax(0,1fr));gap:14px;min-width:980px}

    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;display:flex;gap:12px;align-items:flex-start;transition:.15s;cursor:pointer}
    .card:hover{background:var(--card2);transform:translateY(-1px)}
    .icon{width:36px;height:36px;flex:0 0 36px;border-radius:8px;background:#101010;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .icon img{width:100%;height:100%;object-fit:contain}
    .num{color:var(--accent);font-weight:700;margin-bottom:6px}
    .title{font-weight:700}
    .sub{color:var(--muted);margin-top:6px;font-size:.95em}
    .hidden{display:none}

    /* sloupce (layout.w z JSONu) */
    .col-1{grid-column:span 1}.col-2{grid-column:span 2}.col-3{grid-column:span 3}
    .col-4{grid-column:span 4}.col-5{grid-column:span 5}.col-6{grid-column:span 6}
    .col-7{grid-column:span 7}.col-8{grid-column:span 8}.col-9{grid-column:span 9}
    .col-10{grid-column:span 10}.col-11{grid-column:span 11}.col-12{grid-column:span 12}

    /* sticky info bar dole (počty) */
    .infobar{position:sticky;bottom:0;left:0;right:0;background:rgba(20,20,20,.9);border-top:1px solid #1f1f1f;padding:8px 12px;font-size:.9em;color:#ccc}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Digitální Tržiště</h1>
      <div class="topright">
        <input id="q" class="search" placeholder="Hledat (název, číslo, tagy)…">
        <button id="z-" class="btn">−</button>
        <button id="z+" class="btn">+</button>
        <button id="zr" class="btn">100%</button>
      </div>
    </header>

    <aside id="sidebar"></aside>

    <main id="main">
      <div id="grid" class="grid"></div>
      <div id="info" class="infobar"></div>
    </main>
  </div>

  <script>
    // ==== KONFIG NAČÍTÁNÍ – nejdřív zkus catalog.json, pak final_catalog.json, pak data.json ====
    const bust = '?v=' + Date.now();
    const SOURCES = ['catalog.json','final_catalog.json','data.json'].map(x => x + bust);
    let Z = 1.0;

    const $ = s => document.querySelector(s);
    const sidebar = $('#sidebar');
    const grid = $('#grid');
    const info = $('#info');
    const main = $('#main');
    const q = $('#q');

    function setZoom(v){ Z = Math.max(0.6, Math.min(2.0, v)); main.style.transform = `scale(${Z})`; $('#zr').textContent = Math.round(Z*100)+'%'; }
    $('#z+').onclick = ()=> setZoom(Z+0.1);
    $('#z-').onclick = ()=> setZoom(Z-0.1);
    $('#zr').onclick = ()=> setZoom(1.0);

    function iconEl(src){
      const w = document.createElement('div'); w.className='icon';
      const img = document.createElement('img'); img.src = src || 'default.svg';
      img.onerror = ()=> w.classList.add('hidden');
      w.appendChild(img); return w;
    }

    function cardEl(item){
      const span = item?.layout?.w ? Math.max(1, Math.min(12, item.layout.w)) : 3;
      const el = document.createElement('div'); el.className = `card col-${span}`;
      if(item.url) el.onclick = e => window.open(item.url, '_blank', 'noopener');
      const right = document.createElement('div');
      right.innerHTML = `
        <div class="num">${item.number || ''}</div>
        <div class="title">${item.title || ''}</div>
        <div class="sub">${item.subtitle || ''}</div>
      `;
      el.appendChild(iconEl(item.icon));
      el.appendChild(right);
      return el;
    }

    function normTags(x){
      if(!x) return '';
      if (Array.isArray(x)) return x.join(' ').toLowerCase();
      return String(x).toLowerCase();
    }

    function renderSidebar(cats){
      sidebar.innerHTML = '';
      cats.forEach((c, i) => {
        const a = document.createElement('a');
        a.href='#'; a.className='cat' + (i===0 ? ' active' : '');
        const count = (c.items||[]).length;
        a.innerHTML = `${c.title || c.key} <span class="small">${count} položek</span>`;
        a.onclick = (e)=>{ e.preventDefault();
          sidebar.querySelectorAll('.cat').forEach(x=>x.classList.remove('active'));
          a.classList.add('active');
          renderCategory(c);
        };
        sidebar.appendChild(a);
      });
    }

    function renderCategory(cat){
      const query = q.value.trim().toLowerCase();
      grid.innerHTML = '';
      let items = (cat.items||[]).slice().sort((a,b)=>(a.order||0)-(b.order||0));
      if(query){
        items = items.filter(it=>{
          const hay = [
            it.title, it.subtitle, it.number, it.id, normTags(it.tags)
          ].join(' ').toLowerCase();
          return hay.includes(query);
        });
      }
      items.forEach(it => grid.appendChild(cardEl(it)));
      info.textContent = `Zobrazeno: ${items.length} / ${ (cat.items||[]).length }  |  Kategorie: ${cat.title || cat.key}`;
      main.scrollTo({top:0,behavior:'instant'});
    }

    q.addEventListener('input', ()=>{
      // přerenderuj aktivní kategorii
      const idx = Array.from(sidebar.querySelectorAll('.cat')).findIndex(x=>x.classList.contains('active'));
      if(window.__CATS && window.__CATS[idx]) renderCategory(window.__CATS[idx]);
    });

    async function loadFirstOk(urls){
      for (const u of urls){
        try{
          const r = await fetch(u);
          if(r.ok) return r.json();
        }catch(_){}
      }
      throw new Error('Nelze načíst žádný katalog: '+urls.join(', '));
    }

    function unifyCatalog(data){
      // Podpora starého i nového tvaru
      if(Array.isArray(data.categories)) return data;
      if(Array.isArray(data.items)){
        return { categories:[{ key:'Vše', title:'Vše', description:'Všechny položky', items:data.items }] };
      }
      // Některé staré soubory mohly mít pole nad kořenem:
      if(Array.isArray(data)) return { categories:[{ key:'Vše', title:'Vše', items:data }] };
      return { categories:[] };
    }

    (async function init(){
      try{
        const raw = await loadFirstOk(SOURCES);
        const catalog = unifyCatalog(raw);
        window.__CATS = catalog.categories || [];

        // Když máme kategorii Úvod a Aplikace, dej je první
        const orderKeys = ['Úvod','Aplikace'];
        window.__CATS.sort((a,b)=>{
          const ia = orderKeys.indexOf(a.title||a.key); const ib = orderKeys.indexOf(b.title||b.key);
          if(ia>-1 && ib>-1) return ia-ib;
          if(ia>-1) return -1;
          if(ib>-1) return 1;
          return 0;
        });

        renderSidebar(window.__CATS);
        if(window.__CATS[0]) renderCategory(window.__CATS[0]);
        setZoom(1.0);
      }catch(e){
        console.error(e);
        document.body.insertAdjacentHTML('afterbegin',
          '<div style="padding:12px;background:#ffe0e0;color:#900;">Chyba: nenačetl se žádný katalog (catalog.json / final_catalog.json / data.json).</div>');
      }
    })();
  </script>
</body>
</html>


